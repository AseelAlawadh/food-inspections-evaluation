# TODO: Add comment
# 
# Author: 368982
###############################################################################

library('RUnit')

source("foodInspectionUtilities.R")

violations <- c(
		"29. PREVIOUS MINOR VIOLATION(S) CORRECTED 7-42-090 - Comments: PREVIOS MINOR VIOLATIONS, FROM REPORT #1154846 DATED 01-31-2013, NOT CORRECTED: (#35)SEAL OPENINGS ALONG BASEBOARDS IN ALL AREAS,PAINT RAW WOOD BASEBOARDS IN PREP AREA,REPLACE STAINED CEILING TILES IN ALL AREAS,REPLACE MISSING OUTLET COVERS IN ALL AREAS(#40)PROVIDE THERMOMETERS IN ALL COOLERS AND METAL STEM THERMOMETERS FOR INTERNAL TEMPERATURES. INSTRUCTED TO CORRECT VIOLATIONS. SERIOUS VIOLATION 7-42-090. | 36. LIGHTING: REQUIRED MINIMUM FOOT-CANDLES OF LIGHT PROVIDED, FIXTURES SHIELDED - Comments: LIGHTS INSIDE FRONT COOKING AREA HOOD ARE NOT SHIELDED. MUST INSTALL LIGHT SHIELDS OR SHATTER RESISTANT BULBS. | 13. NO EVIDENCE OF RODENT OR INSECT INFESTATION, NO BIRDS, TURTLES OR OTHER ANIMALS - Comments: EVIDENCE OF RODENT INFESTATION. OBSERVED OVER 50 MICE DROPPINGS ON FLOOR ALONG WALL BASE AND CORNERS BEHIND A SHELVING UNIT NEXT TO THE WASHROON IN REAR OF PREMISES, OVER 20 MICE DROPPINGS ON BOTTOM SHELF OF PREP TABLE IN THE KITCHEN AREA  NEAR THE MEAT SLICER, POTS  AND PANS ARE STORED, 0VER 20 MICE DROPPINGS ON FLOOR ALONG WALL BASE BEHIND A TABLE IN THE STORAGE AREA, OVER 30 MICE DROPPINGS ON FLOOR ALONG WALL BASE UNDERNEATH THE RADIATOR AND SHELVING UNIT IN KITCHEN AREA, OVER 25 MICE DROPPINGS UNDERNEATH BOTTOM OF TABLE WHERE THE COFFEE MACHINE IS STORED, 10 MICE DROPPINGS ON A GLUE TRAP BEHIND THE  CHEST FREEZER IN THE STORAGE AREA, 0VER 20 MICE DROPPINGS UNDERNEATH A SHELVING UNIT IN THE STORAGE CLOSET IN REAR NEXT TO THE WASHROOM, OVER 15 MICE DROPPINGS ON FLOOR BEHIND TABLE WHERE TROPHYS AREA STORED. OUTER OPENING NOT PROTECTED. INSTALL MESH SCREEN AT REAR WALL VENT. CRITICAL VIOLATION 7-38-020. MUST REMOVE ALL DROPPINGS, WASH, RINSE AND SANITIZE ALL SURFACES AND EQUIPMENT, HAVE PREMISES SERVICED BY PEST CONTROL COMPANY AND COMPLY WITH ALL FOLLOWING ORDERS. | 2. FACILITIES TO MAINTAIN PROPER TEMPERATURE - Comments: THE AIR TEMPERATURE TAKEN OF THE PREP COOLER IN THE PREP AREA READS 50.9F. POTENTIALLY HAZARDOUS FOODS IN COOLER. CRITICAL VIOLATION 7-38-005(A). COOLER MUST BE REPAIRED AND ABLE TO MAINTAIN FOODS AT 40F OR LESS. | 3. POTENTIALLY HAZARDOUS FOOD MEETS TEMPERATURE REQUIREMENT DURING STORAGE, PREPARATION DISPLAY AND SERVICE - Comments: THE INTERNAL TEMPERATURES TAKEN OF POTENTIALLY HAZARDOUS FOODS INSIDE THE PREP COOLER IN THE FRONT PREP AREA RANGE FROM 46.7F TO 50.9F,FOOD ITEMS ARE SHREDDED CHEESE, SLICED TOMATOES, SOUR CREAM, SHREDDED LETTUCE, SAUSAGE, AND HAM. MANAGER VOLUNTARILY DENATURED AND DESTROYED FOOD ITEMS TOTAL WEIGHT 10LBS, TOTAL COST $50.  CRITICAL VIOLATION 7-38-005(A). | 41. PREMISES MAINTAINED FREE OF LITTER, UNNECESSARY ARTICLES, CLEANING  EQUIPMENT PROPERLY STORED - Comments: MUST REMOVE EXCESSIVE CLUTTER AND UNNECESSARY ITEMS (CAR BATTERY, TROPHYS, UNUSED EQUIPMENT, BOXES ETC.) THROUGHOUT PREMISES. ESPECIALLY UNDERNEATH COUNTER TOP TABLES. ALSO REMOVE EXCESSIVE CLUTTER FROM THE OUTSIDE REAR PORCH AREA TO PREVENT RODENT HARBORAGE. | 34. FLOORS: CONSTRUCTED PER CODE, CLEANED, GOOD REPAIR, COVERING INSTALLED, DUST-LESS CLEANING METHODS USED - Comments: FLOORS NEED DETAIL CLEANING THROUGHOUT PREMISES ALONG WALL BASES, CORNERS AND UNDER SHELVES AND EQUIPMENT. REPLACE MISSING FLOOR TILES IN FRONT OF 3 COMPARTMENT SINK IN REAR KITCHEN AREA AND SEAL HOLES/OPENINGS IN FLOOR IN THE DINNING AREA TO PREVENT RODENT ENTRY OR HARBORAGE. | 33. FOOD AND NON-FOOD CONTACT EQUIPMENT UTENSILS CLEAN, FREE OF ABRASIVE DETERGENTS - Comments: DETAIL CLEAN ALL COOKING EQUIPMENT OF GREASE AND FOOD DEBRIS BUILD-UP AND DEEP FRYER, CLEAN INTERIOR AND EXTERIOR OF ALL COLD HOLDING UNITS OF SPILLS AND OLD FOOD DEBRIS AND DETAIL CLEAN ALL PREP TABLES, SHELVES, COUNTERS, RACKS AND CABINETS THROUGHOUT PREMISES. | 35. WALLS, CEILINGS, ATTACHED EQUIPMENT CONSTRUCTED PER CODE: GOOD REPAIR, SURFACES CLEAN AND DUST-LESS CLEANING METHODS - Comments: DETAIL CLEAN WALLS BEHIND STOVE AND NEAR THE PREP COOLER IN PREP AREA OF FOOD DEBRIS. ALSO SEAL HOLE IN THE REAR AREA WHERE THE OFFICE ENTRANCE IS LOCATED. STAINED AND DIRTY CEILING TILE IN DINING, PREP AND STORAGE AREAS. MUST REPLACE ALL MISSING AND STAINED CEILING TILES.  ACCUMULATED DUST ON WALL/CEILING VENT COVERS. MUST CLEAN. ACCUMULATED DUST/DEBRIS/GREASE IN VENT HOODS AND FILTERS ABOVE COOKING EQUIPMENT (FRONT AND REAR). MUST CLEAN AND MAINTAIN HOODS/FILTERS. | 32. FOOD AND NON-FOOD CONTACT SURFACES PROPERLY DESIGNED, CONSTRUCTED AND MAINTAINED - Comments: MUST REMOVE RUST FROM THE GREASE TRAP AT THE 3 COMPARTMENT SINK IN REAR KITCHEN AREA | 30. FOOD IN ORIGINAL CONTAINER, PROPERLY LABELED: CUSTOMER ADVISORY POSTED AS NEEDED - Comments: MUST LABEL  AND  DATE ALL PREPARED FOODS IN  COOLERS HELD OVER 24 HOURS | 38. VENTILATION: ROOMS AND EQUIPMENT VENTED AS REQUIRED: PLUMBING: INSTALLED AND MAINTAINED - Comments: PLUMBING UNDER 3 COMPARTMENT SINK LEAKS. MUST REPAIR AND MAINTAIN PLUMBING.",	
		"43. FOOD (ICE) DISPENSING UTENSILS, WASH CLOTHS PROPERLY STORED - Comments: OBSERVED ICE SCOOPS STORED IN WITH THE ICE IN THE ICE BINS.  MANAGEMENT INSTRUCTED TO STORE THE ICE SCOOPS OUTSIDE OF THE ICE BIN IN A CLEAN CONTAINER.",
		""
)

test.parseViolationCodes <- function() {
	checkEquals(parseViolationCodes(violations), list(c(29, 36, 13, 2, 3, 41, 34, 33, 35, 32, 30, 38), c(43), integer(0)), "violation codes")
}

test.classifyViolations <- function() {
	checkEquals(classifyViolations(violations), list(c(2, 3, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3), c(3), logical(0)), "violation severities")
}

test.violationCounts <- function() {
	checkEquals(violationCounts(violations), matrix(c(3, 1, 8, 0, 0, 1, 0, 0, 0), ncol=3, byrow=TRUE, dimnames=list(NULL, c("critical", "serious", "minor"))), "violation counts")
}
